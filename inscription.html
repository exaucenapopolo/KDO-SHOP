<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KDO CAMEROUN - Inscription Professionnelle</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-orange: #FF6B00;
            --secondary-blue: #0066CC;
            --accent-gray: #F5F5F5;
            --text-dark: #333333;
            --white: #FFFFFF;
            --success-green: #52C41A;
        }
        
        body {
            background: linear-gradient(135deg, #FF6B00 0%, #FF8E3C 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            padding: 20px 0;
        }
        
        .signup-container {
            max-width: 1000px;
            margin: 0 auto;
        }
        
        .signup-card {
            background: var(--white);
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .signup-header {
            background: linear-gradient(135deg, var(--primary-orange) 0%, #FF8E3C 100%);
            color: white;
            padding: 25px 40px;
            text-align: center;
        }
        
        .logo-text {
            font-size: 32px;
            font-weight: 800;
            margin-bottom: 10px;
            letter-spacing: -1px;
        }
        
        .signup-subtitle {
            font-size: 16px;
            opacity: 0.9;
        }
        
        /* Étapes d'inscription */
        .steps-container {
            padding: 30px 40px 20px;
            border-bottom: 1px solid #E0E0E0;
        }
        
        .steps {
            display: flex;
            justify-content: space-between;
            position: relative;
        }
        
        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 2;
            flex: 1;
        }
        
        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #E0E0E0;
            color: #666;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 18px;
            margin-bottom: 10px;
            transition: all 0.3s;
        }
        
        .step.active .step-number {
            background: var(--primary-orange);
            color: white;
            transform: scale(1.1);
        }
        
        .step.completed .step-number {
            background: var(--success-green);
            color: white;
        }
        
        .step-label {
            font-size: 12px;
            color: #666;
            font-weight: 600;
            text-align: center;
        }
        
        .step.active .step-label {
            color: var(--primary-orange);
        }
        
        .steps-line {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            height: 4px;
            background: #E0E0E0;
            z-index: 1;
        }
        
        .steps-progress {
            height: 100%;
            background: var(--primary-orange);
            width: 0%;
            transition: width 0.5s;
        }
        
        /* Contenu des étapes */
        .step-content {
            padding: 40px;
            min-height: 400px;
            display: flex;
            flex-direction: column;
        }
        
        .step-title {
            color: var(--text-dark);
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .step-description {
            color: #666;
            margin-bottom: 30px;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-label {
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .form-control {
            border: 2px solid #E0E0E0;
            border-radius: 10px;
            padding: 12px 15px;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-control:focus {
            border-color: var(--primary-orange);
            box-shadow: 0 0 0 3px rgba(255, 107, 0, 0.1);
        }
        
        .form-select {
            border: 2px solid #E0E0E0;
            border-radius: 10px;
            padding: 12px 15px;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-select:focus {
            border-color: var(--primary-orange);
            box-shadow: 0 0 0 3px rgba(255, 107, 0, 0.1);
        }
        
        .form-check {
            margin-bottom: 15px;
        }
        
        .form-check-input:checked {
            background-color: var(--primary-orange);
            border-color: var(--primary-orange);
        }
        
        /* Boutons de navigation */
        .step-actions {
            display: flex;
            justify-content: space-between;
            margin-top: auto;
            padding-top: 30px;
            border-top: 1px solid #E0E0E0;
        }
        
        .btn-prev {
            background: transparent;
            border: 2px solid var(--primary-orange);
            color: var(--primary-orange);
            border-radius: 10px;
            padding: 12px 25px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .btn-prev:hover {
            background: var(--accent-gray);
        }
        
        .btn-next, .btn-submit {
            background: var(--primary-orange);
            border: none;
            color: white;
            border-radius: 10px;
            padding: 12px 25px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .btn-next:hover, .btn-submit:hover {
            background: #E55A00;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 0, 0.2);
        }
        
        .btn-submit {
            min-width: 150px;
        }
        
        /* Résumé de confirmation */
        .summary-container {
            background: var(--accent-gray);
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 30px;
        }
        
        .summary-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #D0D0D0;
        }
        
        .summary-item:last-child {
            border-bottom: none;
        }
        
        .summary-label {
            font-weight: 600;
            color: var(--text-dark);
        }
        
        .summary-value {
            color: #666;
        }
        
        /* Message de succès */
        .success-message {
            text-align: center;
            padding: 40px 20px;
        }
        
        .success-icon {
            font-size: 80px;
            color: var(--success-green);
            margin-bottom: 20px;
        }
        
        .success-title {
            color: var(--success-green);
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 15px;
        }
        
        .success-text {
            color: #666;
            margin-bottom: 30px;
            font-size: 16px;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .signup-header, .steps-container, .step-content {
                padding: 20px;
            }
            
            .step-number {
                width: 35px;
                height: 35px;
                font-size: 16px;
            }
            
            .steps-line {
                top: 17px;
            }
            
            .step-label {
                font-size: 10px;
            }
        }
        
        @media (max-width: 576px) {
            .step-actions {
                flex-direction: column;
                gap: 15px;
            }
            
            .btn-prev, .btn-next, .btn-submit {
                width: 100%;
            }
        }
        
        .error-message {
            color: #dc3545;
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }
        
        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            min-width: 300px;
            display: none;
        }
        
        /* Bouton Google */
        .btn-google {
            background: white;
            border: 2px solid #E0E0E0;
            border-radius: 10px;
            padding: 12px;
            font-size: 16px;
            font-weight: 600;
            color: #333;
            width: 100%;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }
        
        .btn-google:hover {
            background: #f8f9fa;
            border-color: #ccc;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .btn-google img {
            width: 20px;
            height: 20px;
        }
        
        .divider {
            display: flex;
            align-items: center;
            margin: 30px 0;
            color: #999;
        }
        
        .divider::before,
        .divider::after {
            content: '';
            flex: 1;
            border-bottom: 1px solid #E0E0E0;
        }
        
        .divider span {
            padding: 0 15px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <!-- Notification -->
    <div id="notification" class="notification alert alert-dismissible fade" role="alert">
        <div class="d-flex align-items-center">
            <i class="fas fa-info-circle me-3" style="font-size: 24px;"></i>
            <div>
                <strong id="notificationTitle"></strong>
                <p class="mb-0 small" id="notificationMessage"></p>
            </div>
        </div>
        <button type="button" class="btn-close" onclick="hideNotification()"></button>
    </div>
    
    <div class="container signup-container">
        <div class="signup-card">
            <!-- Header -->
            <div class="signup-header">
                <h1 class="logo-text">KDO CAMEROUN</h1>
                <p class="signup-subtitle">Créez votre compte professionnel en 4 étapes simples</p>
            </div>
            
            <!-- Étapes d'inscription -->
            <div class="steps-container">
                <div class="steps">
                    <div class="steps-line">
                        <div class="steps-progress" id="stepsProgress"></div>
                    </div>
                    
                    <div class="step active" id="step1">
                        <div class="step-number">1</div>
                        <div class="step-label">Informations<br>personnelles</div>
                    </div>
                    
                    <div class="step" id="step2">
                        <div class="step-number">2</div>
                        <div class="step-label">Coordonnées<br>& téléphone</div>
                    </div>
                    
                    <div class="step" id="step3">
                        <div class="step-number">3</div>
                        <div class="step-label">Type de<br>compte</div>
                    </div>
                    
                    <div class="step" id="step4">
                        <div class="step-number">4</div>
                        <div class="step-label">Confirmation<br>finale</div>
                    </div>
                </div>
            </div>
            
            <!-- Contenu des étapes -->
            <div class="step-content">
                <!-- Étape 1: Informations personnelles -->
                <div class="step-pane active" id="step1Content">
                    <h2 class="step-title">Informations personnelles</h2>
                    <p class="step-description">Veuillez fournir vos informations de base pour créer votre compte.</p>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label" for="firstName">Prénom *</label>
                                <input type="text" class="form-control" id="firstName" placeholder="Votre prénom" required>
                                <div class="error-message" id="firstNameError">Ce champ est requis</div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label" for="lastName">Nom de famille *</label>
                                <input type="text" class="form-control" id="lastName" placeholder="Votre nom" required>
                                <div class="error-message" id="lastNameError">Ce champ est requis</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="email">Email professionnel *</label>
                        <input type="email" class="form-control" id="email" placeholder="votre@email.com" required>
                        <div class="error-message" id="emailError">Veuillez entrer un email valide</div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label" for="password">Mot de passe *</label>
                                <input type="password" class="form-control" id="password" placeholder="Min. 8 caractères" required>
                                <div class="error-message" id="passwordError">Le mot de passe doit contenir au moins 8 caractères</div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label" for="confirmPassword">Confirmer le mot de passe *</label>
                                <input type="password" class="form-control" id="confirmPassword" placeholder="Répétez le mot de passe" required>
                                <div class="error-message" id="confirmPasswordError">Les mots de passe ne correspondent pas</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="divider">
                        <span>Ou inscrivez-vous avec</span>
                    </div>
                    
                    <button type="button" class="btn-google" id="googleSignupBtn">
                        <img src="https://www.google.com/favicon.ico" alt="Google Logo">
                        S'inscrire avec Google
                    </button>
                    
                    <div class="step-actions">
                        <div></div>
                        <button class="btn-next" onclick="nextStep(2)">Suivant <i class="fas fa-arrow-right ms-2"></i></button>
                    </div>
                </div>
                
                <!-- Étape 2: Coordonnées -->
                <div class="step-pane" id="step2Content" style="display: none;">
                    <h2 class="step-title">Coordonnées & téléphone</h2>
                    <p class="step-description">Où pouvons-nous vous contacter ?</p>
                    
                    <div class="form-group">
                        <label class="form-label" for="phone">Numéro de téléphone *</label>
                        <input type="tel" class="form-control" id="phone" placeholder="Ex: +237 6 81 14 46 38" required>
                        <div class="error-message" id="phoneError">Veuillez entrer un numéro de téléphone valide</div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="country">Pays *</label>
                        <select class="form-select" id="country" required>
                            <option value="">Sélectionnez votre pays</option>
                            <option value="cameroun">Cameroun</option>
                            <option value="congo">Congo</option>
                            <option value="tchad">Tchad</option>
                            <option value="centrafrique">Centrafrique</option>
                            <option value="gabon">Gabon</option>
                            <option value="guinee">Guinée Équatoriale</option>
                        </select>
                        <div class="error-message" id="countryError">Veuillez sélectionner votre pays</div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="city">Ville *</label>
                        <input type="text" class="form-control" id="city" placeholder="Votre ville" required>
                        <div class="error-message" id="cityError">Veuillez entrer votre ville</div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="address">Adresse complète</label>
                        <textarea class="form-control" id="address" rows="3" placeholder="Votre adresse complète"></textarea>
                    </div>
                    
                    <div class="step-actions">
                        <button class="btn-prev" onclick="prevStep(1)"><i class="fas fa-arrow-left me-2"></i> Précédent</button>
                        <button class="btn-next" onclick="nextStep(3)">Suivant <i class="fas fa-arrow-right ms-2"></i></button>
                    </div>
                </div>
                
                <!-- Étape 3: Type de compte -->
                <div class="step-pane" id="step3Content" style="display: none;">
                    <h2 class="step-title">Type de compte</h2>
                    <p class="step-description">Sélectionnez le type de compte qui correspond à votre activité.</p>
                    
                    <div class="row">
                        <div class="col-md-6 mb-4">
                            <div class="card h-100 border-2" id="buyerCard" style="cursor: pointer; border-color: #E0E0E0;">
                                <div class="card-body text-center p-4">
                                    <div class="mb-3">
                                        <i class="fas fa-shopping-cart fa-3x text-primary"></i>
                                    </div>
                                    <h4 class="card-title">Acheteur</h4>
                                    <p class="card-text">Je souhaite acheter des produits en gros pour ma boutique</p>
                                    <div class="form-check mt-3">
                                        <input class="form-check-input" type="radio" name="accountType" id="buyer" value="acheteur" checked>
                                        <label class="form-check-label" for="buyer">
                                            Sélectionner
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6 mb-4">
                            <div class="card h-100 border-2" id="sellerCard" style="cursor: pointer; border-color: #E0E0E0;">
                                <div class="card-body text-center p-4">
                                    <div class="mb-3">
                                        <i class="fas fa-store fa-3x text-primary"></i>
                                    </div>
                                    <h4 class="card-title">Vendeur</h4>
                                    <p class="card-text">Je souhaite vendre mes produits sur la plateforme</p>
                                    <div class="form-check mt-3">
                                        <input class="form-check-input" type="radio" name="accountType" id="seller" value="vendeur">
                                        <label class="form-check-label" for="seller">
                                            Sélectionner
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="businessName">Nom de votre entreprise / boutique</label>
                        <input type="text" class="form-control" id="businessName" placeholder="Si applicable">
                    </div>
                    
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="terms" required>
                        <label class="form-check-label" for="terms">
                            J'accepte les <a href="#" class="text-primary">Conditions Générales d'Utilisation</a> 
                            et la <a href="#" class="text-primary">Politique de Confidentialité</a> *
                        </label>
                        <div class="error-message" id="termsError">Vous devez accepter les conditions</div>
                    </div>
                    
                    <div class="step-actions">
                        <button class="btn-prev" onclick="prevStep(2)"><i class="fas fa-arrow-left me-2"></i> Précédent</button>
                        <button class="btn-next" onclick="nextStep(4)">Suivant <i class="fas fa-arrow-right ms-2"></i></button>
                    </div>
                </div>
                
                <!-- Étape 4: Confirmation -->
                <div class="step-pane" id="step4Content" style="display: none;">
                    <h2 class="step-title">Confirmation finale</h2>
                    <p class="step-description">Vérifiez vos informations avant de finaliser l'inscription.</p>
                    
                    <div class="summary-container">
                        <div class="summary-item">
                            <span class="summary-label">Nom complet:</span>
                            <span class="summary-value" id="summaryName"></span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Email:</span>
                            <span class="summary-value" id="summaryEmail"></span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Téléphone:</span>
                            <span class="summary-value" id="summaryPhone"></span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Pays:</span>
                            <span class="summary-value" id="summaryCountry"></span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Ville:</span>
                            <span class="summary-value" id="summaryCity"></span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Type de compte:</span>
                            <span class="summary-value" id="summaryAccountType"></span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Entreprise:</span>
                            <span class="summary-value" id="summaryBusiness"></span>
                        </div>
                    </div>
                    
                    <div class="form-check mb-4">
                        <input class="form-check-input" type="checkbox" id="confirmInfo">
                        <label class="form-check-label" for="confirmInfo">
                            Je confirme que toutes les informations ci-dessus sont correctes
                        </label>
                        <div class="error-message" id="confirmError">Vous devez confirmer vos informations</div>
                    </div>
                    
                    <div class="step-actions">
                        <button class="btn-prev" onclick="prevStep(3)"><i class="fas fa-arrow-left me-2"></i> Précédent</button>
                        <button class="btn-submit" onclick="submitRegistration()">
                            <i class="fas fa-check me-2"></i> Créer mon compte
                        </button>
                    </div>
                </div>
                
                <!-- Étape 5: Succès -->
                <div class="step-pane" id="step5Content" style="display: none;">
                    <div class="success-message">
                        <div class="success-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <h2 class="success-title">Compte créé avec succès !</h2>
                        <p class="success-text">
                            Félicitations ! Votre compte professionnel a été créé avec succès.<br>
                            Vous allez être redirigé vers votre tableau de bord.
                        </p>
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Chargement...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap & jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Firebase SDK - Version compatibilité -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>

    <script>
        // Nouvelle configuration Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAYcjkrXKcjqFnf8E91JZWU1lMGS-yxSOU",
            authDomain: "kdo-cameroun.firebaseapp.com",
            projectId: "kdo-cameroun",
            storageBucket: "kdo-cameroun.firebasestorage.app",
            messagingSenderId: "445876564547",
            appId: "1:445876564547:web:26507d61bb091fa7bd1af6",
            measurementId: "G-FX2DVSKLKZ"
        };

        // Initialiser Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Variables globales
        let currentStep = 1;
        
        // Fonctions de notification
        function showNotification(title, message, type = 'success') {
            const notification = document.getElementById('notification');
            const titleEl = document.getElementById('notificationTitle');
            const messageEl = document.getElementById('notificationMessage');
            
            titleEl.textContent = title;
            messageEl.textContent = message;
            
            // Changer la classe en fonction du type
            notification.className = `notification alert alert-${type} alert-dismissible fade show`;
            
            // Afficher
            notification.style.display = 'block';
            
            // Auto-hide après 5 secondes
            setTimeout(() => {
                hideNotification();
            }, 5000);
        }
        
        function hideNotification() {
            const notification = document.getElementById('notification');
            notification.style.display = 'none';
        }
        
        function updateStepsProgress() {
            const progress = ((currentStep - 1) / 4) * 100;
            document.getElementById('stepsProgress').style.width = progress + '%';
        }
        
        function showStep(step) {
            // Masquer toutes les étapes
            document.querySelectorAll('.step-pane').forEach(pane => {
                pane.style.display = 'none';
            });
            
            // Afficher l'étape actuelle
            document.getElementById('step' + step + 'Content').style.display = 'block';
            
            // Mettre à jour les indicateurs d'étape
            document.querySelectorAll('.step').forEach(stepEl => {
                stepEl.classList.remove('active', 'completed');
            });
            
            for (let i = 1; i <= step; i++) {
                const stepEl = document.getElementById('step' + i);
                if (i === step) {
                    stepEl.classList.add('active');
                } else {
                    stepEl.classList.add('completed');
                }
            }
            
            updateStepsProgress();
        }
        
        function validateStep(step) {
            let isValid = true;
            
            if (step === 1) {
                const firstName = document.getElementById('firstName').value.trim();
                const lastName = document.getElementById('lastName').value.trim();
                const email = document.getElementById('email').value.trim();
                const password = document.getElementById('password').value;
                const confirmPassword = document.getElementById('confirmPassword').value;
                
                // Validation des champs
                if (!firstName) {
                    document.getElementById('firstNameError').style.display = 'block';
                    isValid = false;
                } else {
                    document.getElementById('firstNameError').style.display = 'none';
                }
                
                if (!lastName) {
                    document.getElementById('lastNameError').style.display = 'block';
                    isValid = false;
                } else {
                    document.getElementById('lastNameError').style.display = 'none';
                }
                
                if (!email || !email.includes('@')) {
                    document.getElementById('emailError').style.display = 'block';
                    isValid = false;
                } else {
                    document.getElementById('emailError').style.display = 'none';
                }
                
                if (!password || password.length < 8) {
                    document.getElementById('passwordError').style.display = 'block';
                    isValid = false;
                } else {
                    document.getElementById('passwordError').style.display = 'none';
                }
                
                if (password !== confirmPassword) {
                    document.getElementById('confirmPasswordError').style.display = 'block';
                    isValid = false;
                } else {
                    document.getElementById('confirmPasswordError').style.display = 'none';
                }
            }
            
            if (step === 2) {
                const phone = document.getElementById('phone').value.trim();
                const country = document.getElementById('country').value;
                const city = document.getElementById('city').value.trim();
                
                if (!phone) {
                    document.getElementById('phoneError').style.display = 'block';
                    isValid = false;
                } else {
                    document.getElementById('phoneError').style.display = 'none';
                }
                
                if (!country) {
                    document.getElementById('countryError').style.display = 'block';
                    isValid = false;
                } else {
                    document.getElementById('countryError').style.display = 'none';
                }
                
                if (!city) {
                    document.getElementById('cityError').style.display = 'block';
                    isValid = false;
                } else {
                    document.getElementById('cityError').style.display = 'none';
                }
            }
            
            if (step === 3) {
                const terms = document.getElementById('terms').checked;
                
                if (!terms) {
                    document.getElementById('termsError').style.display = 'block';
                    isValid = false;
                } else {
                    document.getElementById('termsError').style.display = 'none';
                }
            }
            
            if (step === 4) {
                const confirmInfo = document.getElementById('confirmInfo').checked;
                
                if (!confirmInfo) {
                    document.getElementById('confirmError').style.display = 'block';
                    isValid = false;
                } else {
                    document.getElementById('confirmError').style.display = 'none';
                }
            }
            
            return isValid;
        }
        
        function nextStep(next) {
            if (validateStep(currentStep)) {
                if (next === 4) {
                    // Mettre à jour le résumé
                    document.getElementById('summaryName').textContent = 
                        document.getElementById('firstName').value + ' ' + document.getElementById('lastName').value;
                    document.getElementById('summaryEmail').textContent = document.getElementById('email').value;
                    document.getElementById('summaryPhone').textContent = document.getElementById('phone').value;
                    
                    const countrySelect = document.getElementById('country');
                    document.getElementById('summaryCountry').textContent = 
                        countrySelect.options[countrySelect.selectedIndex].text;
                    
                    document.getElementById('summaryCity').textContent = document.getElementById('city').value;
                    
                    const accountType = document.querySelector('input[name="accountType"]:checked').value;
                    document.getElementById('summaryAccountType').textContent = 
                        accountType === 'acheteur' ? 'Acheteur' : 'Vendeur';
                    
                    const businessName = document.getElementById('businessName').value;
                    document.getElementById('summaryBusiness').textContent = businessName || 'Non spécifié';
                }
                
                currentStep = next;
                showStep(currentStep);
            }
        }
        
        function prevStep(prev) {
            currentStep = prev;
            showStep(currentStep);
        }
        
        // Fonction pour l'inscription avec Google
        async function signupWithGoogle() {
            try {
                const provider = new firebase.auth.GoogleAuthProvider();
                
                // Désactiver le bouton Google
                const googleBtn = document.getElementById('googleSignupBtn');
                const originalText = googleBtn.innerHTML;
                googleBtn.innerHTML = '<img src="https://www.google.com/favicon.ico" alt="Google Logo"> Inscription en cours...';
                googleBtn.disabled = true;
                
                const result = await auth.signInWithPopup(provider);
                const user = result.user;
                
                console.log("✅ Inscription Google réussie avec UID:", user.uid);
                
                // Vérifier si l'utilisateur existe déjà dans Firestore
                const userDoc = await db.collection("users").doc(user.uid).get();
                
                if (!userDoc.exists) {
                    // Créer un nouvel utilisateur dans Firestore avec TOUS les champs nécessaires
                    const userData = {
                        uid: user.uid,
                        firstName: user.displayName?.split(' ')[0] || '',
                        lastName: user.displayName?.split(' ').slice(1).join(' ') || '',
                        email: user.email,
                        phone: user.phoneNumber || '',
                        photoURL: user.photoURL,
                        accountType: 'acheteur', // Par défaut
                        createdAt: new Date().toISOString(),
                        lastLogin: new Date().toISOString(),
                        status: 'active',
                        emailVerified: user.emailVerified,
                        provider: 'google',
                        country: '',
                        city: '',
                        address: '',
                        businessName: '',
                        
                        // CHAMPS NÉCESSAIRES POUR LE TABLEAU DE BORD
                        displayName: user.displayName || '',
                        phoneNumber: user.phoneNumber || '',
                        isActive: true,
                        role: "client",
                        preferences: {
                            notifications: true,
                            newsletter: true
                        },
                        stats: {
                            totalOrders: 0,
                            totalSpent: 0,
                            favoriteCategories: []
                        },
                        // Champs supplémentaires pour compatibilité
                        address: '',
                        city: '',
                        country: 'Cameroun',
                        updatedAt: new Date().toISOString()
                    };
                    
                    await db.collection("users").doc(user.uid).set(userData);
                    
                    console.log("✅ Nouvel utilisateur Google créé dans Firestore avec tous les champs nécessaires");
                    
                    // Créer un panier vide avec la structure attendue par le tableau de bord
                    const cartData = {
                        userId: user.uid,
                        items: {},
                        totalItems: 0,
                        totalAmount: 0,
                        updatedAt: new Date().toISOString(),
                        createdAt: new Date().toISOString()
                    };
                    
                    await db.collection("carts").doc(user.uid).set(cartData);
                    
                    console.log("✅ Panier créé avec succès pour l'utilisateur Google");
                    
                    // Afficher le message de succès
                    currentStep = 5;
                    showStep(currentStep);
                    
                    // Redirection après 3 secondes
                    setTimeout(() => {
                        window.location.href = 'dashboard.html';
                    }, 3000);
                } else {
                    // Si l'utilisateur existe déjà, mettre à jour les champs manquants
                    const existingData = userDoc.data();
                    const updateData = {};
                    
                    // Vérifier et ajouter les champs manquants
                    if (!existingData.displayName) updateData.displayName = user.displayName || '';
                    if (!existingData.phoneNumber) updateData.phoneNumber = user.phoneNumber || '';
                    if (!existingData.isActive) updateData.isActive = true;
                    if (!existingData.role) updateData.role = "client";
                    if (!existingData.preferences) updateData.preferences = { notifications: true, newsletter: true };
                    if (!existingData.stats) updateData.stats = { totalOrders: 0, totalSpent: 0, favoriteCategories: [] };
                    if (!existingData.updatedAt) updateData.updatedAt = new Date().toISOString();
                    
                    // Mettre à jour si nécessaire
                    if (Object.keys(updateData).length > 0) {
                        await db.collection("users").doc(user.uid).update(updateData);
                        console.log("✅ Champs manquants mis à jour pour l'utilisateur Google");
                    }
                    
                    // Rediriger vers le dashboard
                    showNotification("Info", "Vous êtes déjà inscrit, redirection vers le tableau de bord...", "info");
                    setTimeout(() => {
                        window.location.href = 'dashboard.html';
                    }, 2000);
                }
                
            } catch (error) {
                console.error('❌ Erreur d\'inscription Google:', error);
                
                // Réactiver le bouton Google
                const googleBtn = document.getElementById('googleSignupBtn');
                googleBtn.innerHTML = '<img src="https://www.google.com/favicon.ico" alt="Google Logo"> S\'inscrire avec Google';
                googleBtn.disabled = false;
                
                let errorMessage = 'Erreur d\'inscription avec Google. Veuillez réessayer.';
                
                if (error.code === 'auth/popup-closed-by-user') {
                    errorMessage = 'La fenêtre d\'inscription a été fermée. Veuillez réessayer.';
                } else if (error.code === 'auth/cancelled-popup-request') {
                    errorMessage = 'Inscription annulée. Veuillez réessayer.';
                }
                
                showNotification("Erreur", errorMessage, "danger");
            }
        }
        
        async function submitRegistration() {
            console.log("Début de l'inscription par email...");
            
            if (!validateStep(4)) {
                console.log("Validation échouée");
                return;
            }
            
            // Désactiver le bouton
            const submitBtn = document.querySelector('.btn-submit');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i> Création...';
            submitBtn.disabled = true;
            
            try {
                // Récupérer les données du formulaire
                const firstName = document.getElementById('firstName').value.trim();
                const lastName = document.getElementById('lastName').value.trim();
                const email = document.getElementById('email').value.trim();
                const phone = document.getElementById('phone').value.trim();
                const country = document.getElementById('country').value;
                const city = document.getElementById('city').value.trim();
                const address = document.getElementById('address').value.trim();
                const accountType = document.querySelector('input[name="accountType"]:checked').value;
                const businessName = document.getElementById('businessName').value.trim();
                
                const password = document.getElementById('password').value;
                
                console.log("Données utilisateur récupérées:", { firstName, lastName, email, phone, country, city, address, accountType, businessName });
                console.log("Tentative de création de compte avec email:", email);
                
                // 1. Créer l'utilisateur dans Firebase Authentication
                console.log("Étape 1: Création de l'utilisateur dans Firebase Auth...");
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                const user = userCredential.user;
                
                console.log("✅ Utilisateur créé avec UID:", user.uid);
                showNotification("Succès", "Compte créé dans l'authentification", "success");
                
                // 2. Créer l'objet utilisateur avec TOUS les champs nécessaires pour le tableau de bord
                const userData = {
                    // Champs de base du formulaire
                    uid: user.uid,
                    firstName: firstName,
                    lastName: lastName,
                    email: email,
                    phone: phone,
                    country: country,
                    city: city,
                    address: address,
                    accountType: accountType,
                    businessName: businessName,
                    createdAt: new Date().toISOString(),
                    lastLogin: new Date().toISOString(),
                    status: 'active',
                    emailVerified: user.emailVerified,
                    provider: 'email',
                    
                    // CHAMPS NÉCESSAIRES POUR LE TABLEAU DE BORD
                    displayName: firstName + ' ' + lastName,
                    photoURL: "",
                    phoneNumber: phone, // Même valeur que phone
                    isActive: true,
                    role: "client",
                    preferences: {
                        notifications: true,
                        newsletter: true
                    },
                    stats: {
                        totalOrders: 0,
                        totalSpent: 0,
                        favoriteCategories: []
                    },
                    updatedAt: new Date().toISOString()
                };
                
                console.log("Données utilisateur complètes pour Firestore:", userData);
                
                // 3. Enregistrer les informations dans Firestore
                console.log("Étape 2: Enregistrement dans Firestore...");
                await db.collection("users").doc(user.uid).set(userData);
                
                console.log("✅ Utilisateur enregistré dans Firestore avec tous les champs nécessaires!");
                showNotification("Succès", "Données utilisateur enregistrées", "success");
                
                // 4. Créer un panier vide pour l'utilisateur avec la structure attendue par le tableau de bord
                console.log("Étape 3: Création du panier...");
                const cartData = {
                    userId: user.uid,
                    items: {},
                    totalItems: 0,
                    totalAmount: 0,
                    updatedAt: new Date().toISOString(),
                    createdAt: new Date().toISOString()
                };
                
                await db.collection("carts").doc(user.uid).set(cartData);
                console.log("✅ Panier créé avec succès!");
                
                // 5. Afficher le message de succès
                console.log("Affichage du message de succès...");
                currentStep = 5;
                showStep(currentStep);
                
                // 6. Redirection après 3 secondes
                console.log("Redirection dans 3 secondes...");
                setTimeout(() => {
                    console.log("Redirection vers dashboard.html");
                    window.location.href = 'dashboard.html';
                }, 3000);
                
            } catch (error) {
                console.error('❌ Erreur détaillée lors de l\'inscription:', error);
                
                // Réactiver le bouton
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
                
                let errorMessage = 'Erreur lors de la création du compte. Veuillez réessayer.';
                
                // Messages d'erreur plus précis
                if (error.code) {
                    switch(error.code) {
                        case 'auth/email-already-in-use':
                            errorMessage = 'Cette adresse email est déjà utilisée.';
                            break;
                        case 'auth/invalid-email':
                            errorMessage = 'L\'adresse email est invalide.';
                            break;
                        case 'auth/operation-not-allowed':
                            errorMessage = 'L\'inscription par email/mot de passe n\'est pas activée.';
                            break;
                        case 'auth/weak-password':
                            errorMessage = 'Le mot de passe est trop faible. Il doit contenir au moins 8 caractères.';
                            break;
                        case 'auth/network-request-failed':
                            errorMessage = 'Problème de connexion réseau. Vérifiez votre connexion internet.';
                            break;
                        case 'permission-denied':
                            errorMessage = 'Permission refusée. Vérifiez les règles Firestore.';
                            break;
                        default:
                            errorMessage = `Erreur: ${error.message}`;
                    }
                }
                
                // Afficher l'erreur dans une notification
                showNotification("Erreur", errorMessage, "danger");
                console.error("Code d'erreur:", error.code);
                console.error("Message d'erreur:", error.message);
                
                // Afficher aussi une alerte pour s'assurer que l'utilisateur voit l'erreur
                alert("Erreur d'inscription: " + errorMessage);
            }
        }
        
        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            console.log("Page d'inscription chargée");
            
            // Style pour les cartes de type de compte
            const buyerCard = document.getElementById('buyerCard');
            const sellerCard = document.getElementById('sellerCard');
            
            if (buyerCard) {
                buyerCard.addEventListener('click', function() {
                    document.getElementById('buyer').checked = true;
                    buyerCard.style.borderColor = '#FF6B00';
                    if (sellerCard) sellerCard.style.borderColor = '#E0E0E0';
                });
            }
            
            if (sellerCard) {
                sellerCard.addEventListener('click', function() {
                    document.getElementById('seller').checked = true;
                    sellerCard.style.borderColor = '#FF6B00';
                    if (buyerCard) buyerCard.style.borderColor = '#E0E0E0';
                });
            }
            
            // Validation en temps réel
            document.querySelectorAll('input, select, textarea').forEach(element => {
                element.addEventListener('input', function() {
                    const errorId = this.id + 'Error';
                    const errorElement = document.getElementById(errorId);
                    if (errorElement) {
                        errorElement.style.display = 'none';
                    }
                });
            });
            
            // Gestion de l'inscription avec Google
            document.getElementById('googleSignupBtn').addEventListener('click', signupWithGoogle);
            
            // Vérifier si l'utilisateur est déjà connecté
            auth.onAuthStateChanged((user) => {
                if (user) {
                    console.log("Utilisateur déjà connecté, redirection...");
                    window.location.href = 'dashboard.html';
                }
            });
        });
    </script>
</body>
</html>